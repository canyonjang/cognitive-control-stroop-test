<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Stroop Test</title>

  <!-- jsPsych ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="jspsych.js"></script>
  <script src="plugins/jspsych-html-keyboard-response.js"></script>
  <script src="plugins/jspsych-survey-text.js"></script>
  <script src="scenario.js"></script>
  <script src="stroop_numeric.js"></script>

  <!-- âœ… Google Sheetsë¡œ ë°ì´í„° ì „ì†¡ í•¨ìˆ˜ í¬í•¨ -->
  <script src="save_data.js"></script>

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="jspsych-target"></div>

  <script>
    window.onload = function() {
      console.log("âœ… window.onload ì‹¤í–‰ë¨");

      // âœ… query stringì—ì„œ ID ì¶”ì¶œ
      const urlParams = new URLSearchParams(window.location.search);
      const subject_id = urlParams.get("id") || jsPsych.randomization.randomID(8);
      console.log("ğŸ§ª ID í™•ì¸:", subject_id);

      // âœ… ì‹œë‚˜ë¦¬ì˜¤ì™€ stroop_trialì´ ëª¨ë‘ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
      console.log("scenario_trials ìˆìŒ âœ…", scenario_trials);
      console.log("stroop_trials ìˆìŒ âœ…", stroop_trials);

      // âœ… ìµœì¢… íƒ€ì„ë¼ì¸ êµ¬ì„±
      const timeline = [].concat(scenario_trials, stroop_trials);
      console.log("ğŸ§© ìµœì¢… timeline ì¤€ë¹„ë¨ âœ…", timeline);

      // âœ… ì‹¤í—˜ ì‹œì‘
      jsPsych.init({
        timeline: timeline,
        on_finish: function() {
          const data = jsPsych.data.get().values();

          // ID ì¶”ê°€
          data.forEach(d => {
            d.subject_id = subject_id;
          });

          // âœ… Google Sheetsë¡œ ì „ì†¡
          saveDataToSheet(data);

          // âœ… ë°ì´í„° ë¸Œë¼ìš°ì €ì— ì¶œë ¥
          jsPsych.data.displayData();
        }
      });
    };
  </script>
</body>
</html>
