<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Cognitive Control Stroop Test</title>
  <script src="https://cdn.jsdelivr.net/gh/jspsych/jsPsych@6.3.1/jspsych.js"></script>
  <script src="plugins/jspsych-survey-text.js"></script>
  <script src="plugins/jspsych-html-keyboard-response.js"></script>
  <script src="scenario.js"></script>
  <script src="stroop_numeric.js"></script>
  <script src="save_data.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="jspsych-target"></div>

  <script>
    window.onload = function() {
      console.log("🚀 window.onload 실행됨");

      // timeline을 전역으로 정의
      var timeline = [];

      // scenario_trials가 정의되어 있으면 추가
      if (typeof scenario_trials !== "undefined") {
        console.log("✅ scenario_trials 있음");
        timeline.push(...scenario_trials);
      } else {
        console.error("❌ scenario_trials 없음");
      }

      // stroop_trials가 정의되어 있으면 추가
      if (typeof stroop_trials !== "undefined") {
        console.log("✅ stroop_trials 있음");
        timeline.push(...stroop_trials);
      } else {
        console.error("❌ stroop_trials 없음");
      }

      // timeline이 비어있지 않으면 jsPsych 실행
      if (timeline.length > 0) {
        jsPsych.init({
          timeline: timeline,
          on_finish: function() {
           // 마지막 trial 데이터만 구글시트에 전송
            fetch("https://script.google.com/macros/s/여기에_복사한_URL_붙여넣기/exec", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify(jsPsych.data.get().last(1).values()[0])
             });

            jsPsych.data.displayData(); // 결과 화면
          }
        });
      } else {
        console.error("⚠️ timeline이 비어있어 실험 시작 불가");
      }
    };
  </script>
</body>

</html>
