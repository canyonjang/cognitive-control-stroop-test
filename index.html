<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Stroop Test</title>
  <script src="jspsych.js"></script>
  <script src="plugins/jspsych-html-keyboard-response.js"></script>
  <script src="plugins/jspsych-survey-text.js"></script>
  <script src="scenario.js"></script>
  <script src="stroop_numeric.js"></script>
  <script src="save_data.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="jspsych-target"></div>

  <script>
    window.onload = function() {
      console.log("✅ window.onload 실행됨");

      // ✅ query string에서 ID 추출
      const urlParams = new URLSearchParams(window.location.search);
      const subject_id = urlParams.get("id") || jsPsych.randomization.randomID(8);

      console.log("🧪 ID 확인:", subject_id);

      // ✅ 시나리오와 stroop_trial이 모두 준비되었는지 확인
      console.log("scenario_trials 있음 ✅", scenario_trials);
      console.log("stroop_trials 있음 ✅", stroop_trials);

      // ✅ 최종 타임라인
      var timeline = [].concat(scenario_trials, stroop_trials);

      console.log("🧩 최종 timeline 준비됨 ✅", timeline);

      // ✅ 실험 시작
      jsPsych.init({
        timeline: timeline,
        on_finish: function () {
          let all_data = jsPsych.data.get().values();
          fetch("https://script.google.com/macros/s/AKfycbxCeYdGMlbgWYYMVBKSNm-xXblsnXotGYPMZAjLzK_2EzMXLrJxsMMjbFNncFl_QmyhxQ/exec", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(all_data)
          });
          jsPsych.data.displayData(); // 또는 thankyou.html로 이동
        }
      });
    };
  </script>
</body>
</html>
