<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Cognitive Control Stroop Test</title>
  <script src="https://cdn.jsdelivr.net/gh/jspsych/jsPsych@6.3.1/jspsych.js"></script>
  <script src="plugins/jspsych-survey-text.js"></script>
  <script src="plugins/jspsych-html-keyboard-response.js"></script>
  <script src="scenario.js"></script>
  <script src="stroop_numeric.js"></script>
  <script src="save_data.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="jspsych-target"></div>

  <script>
  // ✅ 1. URL에서 ID 추출
  function getSubjectIDFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('id') || jsPsych.randomization.randomID(8);
  }

  var subject_id = getSubjectIDFromURL();

  // ✅ 2. 조건도 랜덤으로 정합니다 (있다면)
  var condition = jsPsych.randomization.sampleWithoutReplacement(["easy", "hard"], 1)[0];

  // ✅ 3. 실험 타임라인 구성
  var timeline = [];

  timeline.push({
    type: 'html-keyboard-response',
    stimulus: '<p>3 3 3</p>',
    choices: ['1','2','3','4','5'],
    data: {
      task: 'stroop',
      subject_id: subject_id,
      condition: condition,
      trial_index: 1,
      correct: '3'
    },
    on_finish: function(data){
      data.correct = data.response == data.correct;
    }
  });

  // ✅ 4. 실험 시작
  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      let all_data = jsPsych.data.get().values();

      fetch("https://script.google.com/macros/s/여기에_복사한_URL_붙여넣기/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(all_data)
      });

      jsPsych.data.displayData();
    }
  });
</script>
</body>

</html>
